<?xml version="1.0" encoding="utf-8"?>
<hibernate-mapping assembly="Vokabular.DataEntities" namespace="Vokabular.DataEntities.Database.Entities" xmlns="urn:nhibernate-mapping-2.2">
  <class name="ResourceVersion" table="[ResourceVersion]" abstract="true">
    <id name="Id" column="Id">
      <generator class="identity" />
    </id>
    
    <property name="VersionNumber" not-null="true" />
    
    <property name="Comment" not-null="false" />
    
    <property name="CreateTime" not-null="true" type="UtcDateTime" />

    <many-to-one name="CreatedByUser" class="User" lazy="proxy" not-null="true" />
    
    <many-to-one name="Resource" class="Resource" lazy="proxy" not-null="true" cascade="save-update" />
    
    <many-to-one name="ParentResource" class="Resource" lazy="proxy" not-null="false" />

    <bag name="Snapshots" table="Snapshot_ResourceVersion" inverse="true" lazy="true">
      <key column="Snapshot" />
      <many-to-many class="ResourceVersion" column="ResourceVersion" />
    </bag>
    

    <joined-subclass table="PageResource" name="PageResource" >
      <key column="ResourceVersionId" />
      
      <property name="Name" not-null="true" />
      <property name="Position" not-null="true" />

      <bag name="Terms" table="PageResource_Term" cascade="save-update" lazy="true">
        <key column="PageResource" />
        <many-to-many class="Term" column="Term" />
      </bag>
    </joined-subclass>

    <joined-subclass table="TextResource" name="TextResource" >
      <key column="ResourceVersionId" />

      <property name="ExternalId" />
      <many-to-one name="BookVersion" class="BookVersionResource" lazy="proxy" />
    </joined-subclass>

    <joined-subclass table="ImageResource" name="ImageResource" >
      <key column="ResourceVersionId" />

      <property name="FileName" not-null="true" />
      <property name="MimeType" not-null="true" />
      <property name="Size" not-null="true" />
    </joined-subclass>

    <joined-subclass table="MetadataResource" name="MetadataResource" >
      <key column="ResourceVersionId" />

      <property name="Title" />
      <property name="SubTitle" />
      <property name="Authors" />
      <property name="RelicAbbreviation" />
      <property name="SourceAbbreviation" />
      <property name="PublishPlace" />
      <property name="PublishDate" />
      <property name="PublisherText" />
      <property name="PublisherEmail" />
      <property name="Copyright" />
      <property name="BiblText" />
      <property name="OriginDate" />
      <property name="NotBefore" type="DateTime2" />
      <property name="NotAfter" type="DateTime2" />
      <property name="ManuscriptIdno" />
      <property name="ManuscriptSettlement" />
      <property name="ManuscriptCountry" />
      <property name="ManuscriptRepository" />
      <property name="ManuscriptExtent" />
      <property name="ManuscriptTitle" />
    </joined-subclass>

    <joined-subclass table="AudioResource" name="AudioResource" >
      <key column="ResourceVersionId" />
      
      <property name="Duration" not-null="false" />
      <property name="FileName" not-null="true" />
      <property name="AudioType" not-null="true" />
      <property name="MimeType" not-null="true" />
    </joined-subclass>

    <joined-subclass table="TrackResource" name="TrackResource" >
      <key column="ResourceVersionId" />

      <property name="Name" not-null="true" />
      <property name="Text" not-null="false" />
      <property name="Position" not-null="true" />
      <many-to-one name="ResourceChapter" class="Resource" lazy="proxy" />
      <many-to-one name="ResourceBeginningPage" class="Resource" lazy="proxy" />
    </joined-subclass>

    <joined-subclass table="ChapterResource" name="ChapterResource" >
      <key column="ResourceVersionId" />
      
      <property name="Name" not-null="true" />
      <property name="Position" not-null="true" />
      <many-to-one name="ResourceBeginningPage" class="Resource" lazy="proxy" />
    </joined-subclass>

    <joined-subclass table="HeadwordResource" name="HeadwordResource" >
      <key column="ResourceVersionId" />
      
      <property name="ExternalId" not-null="true" />
      <property name="DefaultHeadword" not-null="true" />
      <property name="Sorting" not-null="true" />
      <many-to-one name="BookVersion" class="BookVersionResource" lazy="proxy" />

      <bag name="HeadwordItems">
        <key column="HeadwordResource" />
        <one-to-many class="HeadwordItem" />
      </bag>
    </joined-subclass>

    <joined-subclass table="BinaryResource" name="BinaryResource" >
      <key column="ResourceVersionId" />

      <property name="Name" not-null="true" />
      <property name="FileName" not-null="true" />
    </joined-subclass>

    <joined-subclass table="BookVersionResource" name="BookVersionResource" >
      <key column="ResourceVersionId" />

      <property name="ExternalId" />
    </joined-subclass>

  </class>
</hibernate-mapping>